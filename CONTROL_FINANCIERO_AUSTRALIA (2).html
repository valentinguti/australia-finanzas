<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>Finanzas ¬∑ Australia</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=IBM+Plex+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* ‚îÄ‚îÄ TOKENS ‚îÄ‚îÄ */
:root {
  --paper: #F7F4EE;
  --paper2: #F0EDE5;
  --paper3: #E8E4DA;
  --ink: #1A1714;
  --ink2: #3D3A34;
  --ink3: #6B6760;
  --ink4: #A09C96;
  --rule: #D4CFC6;
  --rule2: #C4BFB5;
  --green: #1C3D2A;
  --green2: #2A5C3F;
  --green-l: #EDF4F0;
  --red: #5C1A1A;
  --red-l: #F9F0F0;
  --amber: #4A3200;
  --amber-l: #FBF6E8;
  --serif: 'Playfair Display', Georgia, serif;
  --mono: 'IBM Plex Mono', 'Courier New', monospace;
}
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html { font-size: 15px; -webkit-text-size-adjust: 100%; }
body { background: var(--paper); color: var(--ink); font-family: var(--mono); min-height: 100vh; }

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar {
  background: var(--ink);
  padding: 10px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 200;
}
.topbar-brand {
  font-family: var(--serif);
  font-size: 14px;
  font-style: italic;
  color: var(--paper);
  letter-spacing: .3px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.topbar-right {
  display: flex;
  align-items: center;
  gap: 10px;
}
.tc-chip {
  font-size: 10px;
  color: #999;
  font-family: var(--mono);
  display: flex;
  align-items: center;
  gap: 5px;
}
.tc-dot { width: 5px; height: 5px; border-radius: 50%; background: #4caf50; animation: blink 2s infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:.2} }
.tc-val { color: #ccc; font-weight: 500; }
.sync-st { font-size: 10px; color: #666; font-family: var(--mono); }
.sync-btn {
  background: none; border: 1px solid #444; color: #888;
  font-family: var(--mono); font-size: 10px; padding: 3px 8px;
  cursor: pointer; letter-spacing: .3px;
}
.sync-btn:active { background: #222; }

/* ‚îÄ‚îÄ TAB NAV (spreadsheet tabs) ‚îÄ‚îÄ */
.tabnav {
  background: var(--paper2);
  border-bottom: 2px solid var(--ink);
  display: flex;
  overflow-x: auto;
  scrollbar-width: none;
  padding: 0 4px;
  gap: 1px;
}
.tabnav::-webkit-scrollbar { display: none; }
.tab {
  flex-shrink: 0;
  padding: 9px 16px 7px;
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 500;
  letter-spacing: .8px;
  text-transform: uppercase;
  color: var(--ink4);
  cursor: pointer;
  border-bottom: 3px solid transparent;
  margin-bottom: -2px;
  white-space: nowrap;
  user-select: none;
  transition: color .1s;
}
.tab:hover { color: var(--ink2); }
.tab.on {
  color: var(--ink);
  border-bottom-color: var(--ink);
  background: var(--paper);
  font-weight: 600;
}

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.pg { display: none; padding-bottom: 80px; }
.pg.on { display: block; }

/* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
.shead {
  padding: 18px 18px 0;
  margin-bottom: 0;
}
.shead-row {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  border-bottom: 2px solid var(--ink);
  padding-bottom: 6px;
  margin-bottom: 0;
}
.shead-title {
  font-family: var(--serif);
  font-size: 18px;
  font-weight: 700;
  font-style: italic;
  color: var(--ink);
  letter-spacing: -.2px;
}
.shead-sub {
  font-size: 9px;
  font-weight: 500;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--ink4);
}
.shead-action {
  font-size: 10px;
  color: var(--ink3);
  cursor: pointer;
  background: none;
  border: 1px solid var(--rule2);
  padding: 3px 9px;
  font-family: var(--mono);
  letter-spacing: .3px;
}
.shead-action:active { background: var(--paper3); }

/* ‚îÄ‚îÄ LEDGER TABLE (core component) ‚îÄ‚îÄ */
.ledger { width: 100%; border-collapse: collapse; }
.ledger-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
.ledger th {
  font-family: var(--mono);
  font-size: 8px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--ink4);
  padding: 8px 18px;
  text-align: left;
  background: var(--paper2);
  border-bottom: 1px solid var(--rule2);
  white-space: nowrap;
}
.ledger th.r { text-align: right; }
.ledger td {
  padding: 9px 18px;
  border-bottom: 1px solid var(--rule);
  font-family: var(--mono);
  font-size: 12px;
  color: var(--ink2);
  vertical-align: middle;
}
.ledger tr:last-child td { border-bottom: none; }
.ledger tr.total td {
  background: var(--paper2);
  border-top: 2px solid var(--ink);
  border-bottom: 2px solid var(--ink);
  font-weight: 600;
  color: var(--ink);
}
.ledger tr.subtotal td {
  background: var(--paper3);
  font-weight: 500;
  color: var(--ink);
  border-bottom: 1px solid var(--rule2);
}
.ledger tr:hover td { background: var(--paper2); }
.ledger tr.total:hover td, .ledger tr.subtotal:hover td { background: inherit; }
.num { text-align: right; font-variant-numeric: tabular-nums; }
.pos { color: var(--green) !important; font-weight: 600; }
.neg { color: var(--red) !important; font-weight: 600; }
.dim { color: var(--ink4) !important; font-weight: 300; }
.bold { font-weight: 600 !important; color: var(--ink) !important; }
.italic { font-style: italic; }
.label-cell { font-size: 11px; color: var(--ink3); }

/* ‚îÄ‚îÄ STAT ROW ‚îÄ‚îÄ */
.statrow {
  display: grid;
  border-bottom: 1px solid var(--rule);
}
.statrow-3 { grid-template-columns: 1fr 1fr 1fr; }
.statrow-2 { grid-template-columns: 1fr 1fr; }
.statrow-4 { grid-template-columns: 1fr 1fr 1fr 1fr; }
.stat {
  padding: 14px 18px;
  border-right: 1px solid var(--rule);
}
.statrow-3 .stat:nth-child(3n),
.statrow-2 .stat:nth-child(2n),
.statrow-4 .stat:nth-child(4n) { border-right: none; }
.stat-lbl {
  font-size: 8px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--ink4);
  margin-bottom: 6px;
}
.stat-val {
  font-family: var(--serif);
  font-size: 22px;
  font-weight: 700;
  color: var(--ink);
  line-height: 1;
  letter-spacing: -.3px;
}
.stat-val.g { color: var(--green); }
.stat-val.r { color: var(--red); }
.stat-val.a { color: var(--amber); }
.stat-sub { font-size: 10px; color: var(--ink4); margin-top: 3px; font-weight: 300; }

/* ‚îÄ‚îÄ HIGHLIGHT BAND ‚îÄ‚îÄ */
.band {
  padding: 16px 18px;
  border-bottom: 1px solid var(--rule);
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.band.g { background: var(--green-l); border-left: 3px solid var(--green); }
.band.r { background: var(--red-l); border-left: 3px solid var(--red); }
.band.a { background: var(--amber-l); border-left: 3px solid var(--amber); }
.band-lbl { font-size: 9px; font-weight: 600; letter-spacing: 1.2px; text-transform: uppercase; color: var(--ink4); margin-bottom: 3px; }
.band-val { font-family: var(--serif); font-size: 26px; font-weight: 700; letter-spacing: -.3px; }
.band.g .band-val { color: var(--green); }
.band.r .band-val { color: var(--red); }
.band.a .band-val { color: var(--amber); }
.band-sub { font-size: 10px; color: var(--ink4); margin-top: 2px; }
.band-right { text-align: right; }
.band-pct { font-family: var(--serif); font-size: 32px; font-weight: 700; color: var(--ink3); }

/* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
.progbar { height: 2px; background: var(--rule); overflow: hidden; }
.progbar-fill { height: 100%; background: var(--green); transition: width .8s ease; }
.progbar-fill.a { background: var(--amber); }

/* ‚îÄ‚îÄ MONTH STRIP (spreadsheet-style tabs) ‚îÄ‚îÄ */
.mstrip {
  background: var(--paper2);
  border-bottom: 1px solid var(--rule2);
  display: flex;
  overflow-x: auto;
  scrollbar-width: none;
  padding: 0;
  gap: 0;
}
.mstrip::-webkit-scrollbar { display: none; }
.mtab {
  flex-shrink: 0;
  padding: 8px 13px;
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 500;
  letter-spacing: .5px;
  color: var(--ink4);
  cursor: pointer;
  border-right: 1px solid var(--rule);
  user-select: none;
  white-space: nowrap;
  position: relative;
}
.mtab:hover { background: var(--paper3); color: var(--ink2); }
.mtab.on {
  background: var(--paper);
  color: var(--ink);
  font-weight: 600;
  border-top: 2px solid var(--ink);
}
.mtab.has .mdot {
  position: absolute;
  top: 5px; right: 5px;
  width: 4px; height: 4px;
  border-radius: 50%;
  background: var(--green);
}
.mtab.on.has .mdot { background: var(--green2); }

/* ‚îÄ‚îÄ INLINE INPUTS ‚îÄ‚îÄ */
.inp-num {
  background: transparent;
  border: none;
  border-bottom: 1px solid transparent;
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 500;
  color: var(--ink);
  text-align: right;
  width: 100%;
  outline: none;
  padding: 2px 0;
  -webkit-appearance: none;
}
.inp-num:focus { border-bottom-color: var(--ink); background: var(--paper2); }
.inp-num::placeholder { color: var(--rule2); font-weight: 300; }
input[type=number] { -moz-appearance: textfield; }
input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; }

.inp-text {
  background: transparent;
  border: none;
  border-bottom: 1px solid transparent;
  font-family: var(--mono);
  font-size: 11px;
  color: var(--ink3);
  width: 100%;
  outline: none;
  padding: 2px 0;
}
.inp-text:focus { border-bottom-color: var(--rule2); }
.inp-text::placeholder { color: var(--rule); }

.inp-date {
  background: var(--paper2);
  border: 1px solid var(--rule2);
  font-family: var(--mono);
  font-size: 12px;
  color: var(--ink);
  padding: 7px 10px;
  outline: none;
  width: 100%;
  -webkit-appearance: none;
}
.inp-date:focus { border-color: var(--ink); }

.inp-big {
  background: var(--paper2);
  border: 1px solid var(--rule2);
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 600;
  color: var(--ink);
  padding: 10px 12px;
  text-align: right;
  outline: none;
  width: 100%;
  -webkit-appearance: none;
}
.inp-big:focus { border-color: var(--ink); background: var(--paper); }
.inp-big::placeholder { font-weight: 300; color: var(--ink4); }

.inp-line {
  background: var(--paper2);
  border: 1px solid var(--rule2);
  font-family: var(--mono);
  font-size: 12px;
  color: var(--ink);
  padding: 9px 12px;
  outline: none;
  width: 100%;
  -webkit-appearance: none;
}
.inp-line:focus { border-color: var(--ink); background: var(--paper); }
.inp-line::placeholder { color: var(--ink4); font-weight: 300; }

/* ‚îÄ‚îÄ WEEK INPUTS ‚îÄ‚îÄ */
.week-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  border-bottom: 1px solid var(--rule);
}
.week-cell {
  border-right: 1px solid var(--rule);
  padding: 10px 8px;
  text-align: center;
}
.week-cell:last-child { border-right: none; }
.week-lbl { font-size: 8px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; color: var(--ink4); margin-bottom: 5px; }
.week-inp {
  width: 100%; background: transparent; border: none;
  border-bottom: 1px solid transparent;
  font-family: var(--mono); font-size: 13px; font-weight: 600;
  color: var(--green); text-align: center; outline: none;
  -webkit-appearance: none;
  padding: 2px 0;
}
.week-inp:focus { border-bottom-color: var(--green); background: var(--green-l); }
.week-inp::placeholder { color: var(--rule2); font-weight: 300; font-size: 11px; }

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn {
  background: var(--ink); color: var(--paper);
  border: none; padding: 9px 16px;
  font-family: var(--mono); font-size: 11px; font-weight: 500;
  letter-spacing: .5px; cursor: pointer;
  -webkit-appearance: none; touch-action: manipulation;
}
.btn:active { opacity: .8; }
.btn.g { background: var(--green); }
.btn.r { background: var(--red); }
.btn.sm { padding: 4px 10px; font-size: 10px; }
.btn.full { width: 100%; padding: 12px; font-size: 12px; letter-spacing: .8px; }
.btn.outline { background: none; border: 1px solid var(--rule2); color: var(--ink3); }

/* ‚îÄ‚îÄ FORM LAYOUT ‚îÄ‚îÄ */
.form-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.fg { margin-bottom: 12px; }
.fg label {
  display: block; font-size: 8px; font-weight: 600;
  letter-spacing: 1.5px; text-transform: uppercase;
  color: var(--ink4); margin-bottom: 5px;
}

/* ‚îÄ‚îÄ PAYMENT ITEM ‚îÄ‚îÄ */
.pay-row {
  display: flex; align-items: flex-start; justify-content: space-between;
  gap: 10px; padding: 10px 18px;
  border-bottom: 1px solid var(--rule);
}
.pay-row:last-child { border-bottom: none; }
.pay-date { font-size: 9px; color: var(--ink4); text-transform: uppercase; letter-spacing: .5px; margin-bottom: 2px; }
.pay-desc { font-size: 11px; color: var(--ink3); }
.pay-aud { font-family: var(--serif); font-size: 16px; font-weight: 700; color: var(--green); text-align: right; }
.pay-usd { font-size: 9px; color: var(--ink4); text-align: right; margin-top: 1px; }

/* ‚îÄ‚îÄ FOOTER BAR ‚îÄ‚îÄ */
.fbar {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: var(--ink);
  display: grid; grid-template-columns: 1fr 1px 1fr 1px 1fr;
  z-index: 199;
  padding: 0;
  padding-bottom: env(safe-area-inset-bottom);
}
.fbar-div { background: #333; }
.fi { padding: 10px 14px; text-align: center; }
.fi-lbl { font-size: 8px; letter-spacing: 1.2px; text-transform: uppercase; color: #555; margin-bottom: 3px; }
.fi-val { font-family: var(--serif); font-size: 15px; font-weight: 700; color: #ccc; }
.fi-val.g { color: #6db88a; }
.fi-val.r { color: #d47a7a; }
.fi-val.a { color: #d4ac40; }

/* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
.divider { height: 1px; background: var(--rule); margin: 0; }
.spacer { height: 16px; }
.pad { padding: 14px 18px; }
.empty { text-align: center; padding: 32px 20px; color: var(--ink4); font-style: italic; font-family: var(--serif); font-size: 14px; }
.chip { display: inline-block; font-size: 9px; font-weight: 600; letter-spacing: .8px; text-transform: uppercase; padding: 2px 7px; }
.chip.g { background: var(--green-l); color: var(--green); }
.chip.r { background: var(--red-l); color: var(--red); }
.chip.a { background: var(--amber-l); color: var(--amber); }
.chip.n { background: var(--paper3); color: var(--ink4); }
.rotate { transform: rotate(-2deg); display: inline-block; border: 1px solid currentColor; padding: 1px 6px; font-size: 9px; font-weight: 700; letter-spacing: .8px; text-transform: uppercase; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast {
  position: fixed; bottom: 72px; left: 50%; transform: translateX(-50%);
  background: var(--ink); color: var(--paper);
  font-family: var(--mono); font-size: 11px; padding: 6px 14px;
  z-index: 9999; opacity: 0; transition: opacity .2s; pointer-events: none; white-space: nowrap;
}
#toast.show { opacity: 1; }

/* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
#loading {
  position: fixed; inset: 0; background: var(--paper);
  z-index: 9000; display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 12px;
}
#loading.hide { display: none; }
.spin {
  width: 20px; height: 20px;
  border: 2px solid var(--rule2); border-top-color: var(--ink);
  border-radius: 50%; animation: spin .6s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.spin-lbl { font-family: var(--serif); font-size: 14px; font-style: italic; color: var(--ink4); }

/* ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ */
#auth {
  position: fixed; inset: 0; background: var(--paper);
  z-index: 8900; display: flex; align-items: center; justify-content: center; padding: 24px;
}
.auth-box { width: 100%; max-width: 340px; }
.auth-flag { font-size: 28px; margin-bottom: 16px; display: block; }
.auth-title { font-family: var(--serif); font-size: 28px; font-weight: 700; font-style: italic; color: var(--ink); margin-bottom: 6px; letter-spacing: -.3px; }
.auth-sub { font-size: 11px; color: var(--ink4); line-height: 1.7; margin-bottom: 28px; }
.auth-gbtn {
  width: 100%; background: var(--ink); color: var(--paper);
  border: none; padding: 14px 18px; cursor: pointer;
  font-family: var(--serif); font-size: 16px; font-style: italic;
  display: flex; align-items: center; justify-content: center; gap: 12px;
  margin-bottom: 10px; letter-spacing: .2px;
}
.auth-gbtn:active { opacity: .85; }
.auth-skip {
  width: 100%; background: none; border: 1px solid var(--rule2);
  color: var(--ink4); font-family: var(--mono); font-size: 10px;
  padding: 10px; cursor: pointer; letter-spacing: .5px;
}
.auth-skip:active { background: var(--paper3); }
.auth-note { margin-top: 20px; font-size: 10px; color: var(--ink4); line-height: 1.7; border-top: 1px solid var(--rule); padding-top: 16px; }
.auth-err { min-height: 16px; font-size: 11px; color: var(--red); margin-top: 10px; font-style: italic; }

/* ‚îÄ‚îÄ SETUP GUIDE ‚îÄ‚îÄ */
#setup {
  position: fixed; inset: 0; background: var(--paper);
  z-index: 8800; display: none; overflow-y: auto; padding: 24px;
}
.setup-inner { max-width: 460px; margin: 0 auto; }
.setup-title { font-family: var(--serif); font-size: 22px; font-style: italic; font-weight: 700; color: var(--ink); margin-bottom: 6px; }
.setup-sub { font-size: 11px; color: var(--ink4); line-height: 1.7; margin-bottom: 20px; }
.setup-step { padding: 14px 0; border-bottom: 1px solid var(--rule); }
.setup-step:last-of-type { border-bottom: none; }
.step-n { font-size: 8px; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase; color: var(--ink4); margin-bottom: 5px; }
.step-t { font-size: 12px; color: var(--ink2); line-height: 1.7; }
.step-t code { background: var(--paper3); padding: 1px 5px; font-family: var(--mono); font-size: 11px; color: var(--green); word-break: break-all; }
.step-t input { width: 100%; margin-top: 8px; background: var(--paper2); border: 1px solid var(--rule2); padding: 9px 10px; font-family: var(--mono); font-size: 12px; color: var(--ink); outline: none; }
.step-t input:focus { border-color: var(--ink); }
</style>
</head>
<body>

<div id="loading"><div class="spin"></div><div class="spin-lbl">Cargando...</div></div>
<div id="toast"></div>

<!-- ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê -->
<div id="auth">
  <div class="auth-box">
    <span class="auth-flag">üá¶üá∫</span>
    <div class="auth-title">Finanzas ¬∑ Australia</div>
    <div class="auth-sub">Planilla financiera personal ¬∑ Sincronizaci√≥n autom√°tica entre iPhone y PC v√≠a Google Drive.</div>
    <button class="auth-gbtn" onclick="startGoogle()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#aaa"/>
        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#888"/>
        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#777"/>
        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#999"/>
      </svg>
      Continuar con Google Drive
    </button>
    <button class="auth-skip" onclick="skipAuth()">Usar sin sincronizaci√≥n ‚Üí solo local</button>
    <div class="auth-err" id="auth-err"></div>
    <div class="auth-note">Solo accede a su propia carpeta en tu Drive. Tus archivos personales no son visibles.</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SETUP ‚ïê‚ïê‚ïê -->
<div id="setup">
  <div class="setup-inner">
    <div class="setup-title">Configurar Google Drive</div>
    <div class="setup-sub">Se necesita un Client ID gratuito de Google. Una sola vez, ~5 minutos.</div>
    <div class="setup-step"><div class="step-n">Paso 1</div><div class="step-t">Entr√° a <strong>console.cloud.google.com</strong> ‚Üí cre√° un proyecto nuevo (cualquier nombre).</div></div>
    <div class="setup-step"><div class="step-n">Paso 2</div><div class="step-t"><strong>APIs &amp; Services ‚Üí OAuth consent screen</strong> ‚Üí External ‚Üí complet√° nombre y email ‚Üí guard√°.</div></div>
    <div class="setup-step"><div class="step-n">Paso 3</div><div class="step-t"><strong>Credentials ‚Üí Create Credentials ‚Üí OAuth Client ID</strong> ‚Üí Web application.<br>En "Authorized JavaScript origins" agreg√° la URL donde est√° la app (o <code>null</code> si es archivo local).</div></div>
    <div class="setup-step"><div class="step-n">Paso 4 ¬∑ Peg√° tu Client ID</div><div class="step-t"><input type="text" id="cid-inp" placeholder="123456789-abc...apps.googleusercontent.com"></div></div>
    <div style="padding-top:20px; display:flex; gap:10px;">
      <button class="btn full g" onclick="saveClientId()">Guardar y continuar</button>
      <button class="btn outline" style="flex-shrink:0" onclick="document.getElementById('setup').style.display='none'">‚Üê Volver</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê -->
<div class="topbar">
  <div class="topbar-brand">üá¶üá∫ &nbsp;Finanzas ¬∑ Australia</div>
  <div class="topbar-right">
    <div class="tc-chip">
      <div class="tc-dot" id="tc-dot"></div>
      <span class="tc-val" id="tc-v">‚Äî</span>
      <span id="tc-t" style="font-size:9px;color:#555"></span>
    </div>
    <span class="sync-st" id="sync-st">‚Äî</span>
    <button class="sync-btn" onclick="syncNow()">‚Üë‚Üì</button>
  </div>
</div>

<div class="tabnav" id="tabnav">
  <div class="tab on" onclick="go('dash',this)" data-pg="dash">Resumen</div>
  <div class="tab" onclick="go('deuda',this)" data-pg="deuda">Deuda</div>
  <div class="tab" onclick="go('inv',this)" data-pg="inv">Inversi√≥n</div>
  <div class="tab" onclick="go('meses',this)" data-pg="meses">Meses</div>
  <div class="tab" onclick="go('anual',this)" data-pg="anual">Anual</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     RESUMEN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="pg on" id="pg-dash">

  <div class="shead"><div class="shead-row">
    <span class="shead-title">Resumen general</span>
    <span class="shead-sub" id="d-period">2026</span>
  </div></div>

  <div class="statrow statrow-4">
    <div class="stat"><div class="stat-lbl">Ganado</div><div class="stat-val g" id="d-ga">0</div><div class="stat-sub" id="d-gu">USD 0</div></div>
    <div class="stat"><div class="stat-lbl">Gastado</div><div class="stat-val r" id="d-gsa">0</div><div class="stat-sub" id="d-gsu">USD 0</div></div>
    <div class="stat"><div class="stat-lbl">Ahorro</div><div class="stat-val" id="d-aa">0</div><div class="stat-sub" id="d-au">USD 0</div></div>
    <div class="stat"><div class="stat-lbl">Inversi√≥n</div><div class="stat-val a" id="d-ia">0</div><div class="stat-sub" id="d-iu">USD 0</div></div>
  </div>

  <div class="band g">
    <div>
      <div class="band-lbl">Caja disponible ¬∑ para pagar deuda</div>
      <div class="band-val" id="d-ca">AUD 0.00</div>
      <div class="band-sub" id="d-cu">Ahorro ‚àí pagos realizados</div>
    </div>
    <div style="text-align:right">
      <div class="stat-lbl">En USD</div>
      <div style="font-family:var(--serif);font-size:18px;font-weight:700;color:var(--green)" id="d-cau">USD 0</div>
    </div>
  </div>

  <div class="band r">
    <div>
      <div class="band-lbl">Deuda pendiente ¬∑ padres</div>
      <div class="band-val" id="d-da">AUD 0.00</div>
      <div class="band-sub" id="d-du">USD 0.00</div>
    </div>
    <div class="band-right">
      <div class="band-pct" id="d-dapct">0%</div>
      <div class="band-sub">saldado</div>
    </div>
  </div>

  <div style="padding: 10px 18px 0;">
    <div class="progbar"><div class="progbar-fill a" id="d-pbar" style="width:0%"></div></div>
  </div>

  <div class="spacer"></div>

  <!-- TC manual -->
  <div class="shead"><div class="shead-row">
    <span class="shead-title">Tipo de cambio</span>
    <span class="shead-sub">1 AUD ‚Üí USD</span>
  </div></div>
  <div style="padding: 12px 18px; display:flex; align-items:center; gap:10px; border-bottom:1px solid var(--rule);">
    <span style="font-size:11px;color:var(--ink4);">1 AUD =</span>
    <input type="number" step="0.0001" inputmode="decimal" id="tc-inp" class="inp-big" style="width:130px" placeholder="0.6500" oninput="manualTC()">
    <span style="font-size:11px;color:var(--ink4);">USD &nbsp;<span id="tc-src" style="font-style:italic;color:var(--ink4);font-size:10px">autom√°tico</span></span>
  </div>

  <div class="spacer"></div>

  <!-- √öltimo mes -->
  <div class="shead"><div class="shead-row">
    <span class="shead-title">√öltimo mes</span>
    <span id="d-lm-name" class="shead-sub">‚Äî</span>
  </div></div>
  <div id="d-last-content"><div class="empty">Sin datos a√∫n</div></div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     DEUDA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="pg" id="pg-deuda">

  <div class="shead" style="margin-top:16px"><div class="shead-row">
    <span class="shead-title">Deuda con padres</span>
    <span id="deu-chip" class="chip r">AUD 0</span>
  </div></div>

  <div class="ledger-wrap">
    <table class="ledger">
      <thead><tr><th>Concepto</th><th class="r">AUD</th><th class="r">USD</th></tr></thead>
      <tbody>
        <tr><td class="label-cell italic">Inversi√≥n inicial</td><td class="num dim" id="dl-inv">0.00</td><td class="num dim" id="dl-invu">0.00</td></tr>
        <tr><td class="label-cell italic">Gastos sin ingresos</td><td class="num dim" id="dl-gsi">0.00</td><td class="num dim" id="dl-gsiu">0.00</td></tr>
        <tr class="subtotal"><td class="bold">Deuda bruta</td><td class="num neg" id="dl-bruta">0.00</td><td class="num neg" id="dl-brutau">0.00</td></tr>
        <tr><td class="label-cell italic">Pagos realizados</td><td class="num pos" id="dl-pag">0.00</td><td class="num pos" id="dl-pagu">0.00</td></tr>
        <tr class="total"><td class="bold">Deuda pendiente</td><td class="num neg bold" id="dl-pend">0.00</td><td class="num neg" id="dl-pendu">0.00</td></tr>
      </tbody>
    </table>
  </div>

  <div style="padding: 8px 18px 12px;">
    <div class="progbar"><div class="progbar-fill" id="deu-bar" style="width:0%"></div></div>
    <div style="display:flex;justify-content:space-between;margin-top:5px;font-size:10px;color:var(--ink4);">
      <span>Pagado</span><span id="deu-pct">0.0%</span>
    </div>
  </div>

  <div class="band g" style="margin-bottom:0">
    <div>
      <div class="band-lbl">Caja disponible</div>
      <div class="band-val" id="deu-ca">AUD 0.00</div>
    </div>
    <div style="text-align:right;font-size:11px;color:var(--green)" id="deu-cau">USD 0.00</div>
  </div>

  <div class="spacer"></div>

  <!-- Registrar pago -->
  <div class="shead"><div class="shead-row">
    <span class="shead-title">Registrar pago</span>
  </div></div>
  <div style="padding:14px 18px; border-bottom:1px solid var(--rule);">
    <div class="form-2" style="margin-bottom:10px;">
      <div class="fg" style="margin:0"><label>Fecha</label><input type="date" class="inp-date" id="pago-f"></div>
      <div class="fg" style="margin:0"><label>Monto AUD</label><input type="number" step="0.01" inputmode="decimal" class="inp-big" id="pago-m" placeholder="0.00"></div>
    </div>
    <div class="fg"><label>Descripci√≥n</label><input type="text" id="pago-d" class="inp-line" placeholder="Ej: Transferencia mayo"></div>
    <button class="btn g full" onclick="regPago()">Registrar pago ‚Üí</button>
  </div>

  <!-- Historial -->
  <div class="shead"><div class="shead-row">
    <span class="shead-title">Historial</span>
    <span id="deu-np" class="shead-sub">0 pagos</span>
  </div></div>
  <div id="pag-list"><div class="empty">Sin pagos registrados a√∫n.</div></div>

  <!-- Cuota -->
  <div class="shead"><div class="shead-row">
    <span class="shead-title">Calculadora de cuotas</span>
  </div></div>
  <div style="padding:14px 18px;border-bottom:1px solid var(--rule)">
    <div class="form-2" style="margin-bottom:8px;">
      <div class="fg" style="margin:0"><label>Meses para saldar</label><input type="number" inputmode="numeric" class="inp-big" id="cuota-m" placeholder="12" oninput="calcCuota()"></div>
      <div class="fg" style="margin:0"><label>Cuota mensual</label>
        <div style="background:var(--green-l);border:1px solid var(--green);padding:10px 12px;text-align:right;font-family:var(--serif);font-size:18px;font-weight:700;color:var(--green)" id="cuota-r">‚Äî</div>
      </div>
    </div>
    <div id="cuota-s" style="font-size:10px;color:var(--ink4);font-style:italic"></div>
  </div>

  <!-- Nota -->
  <div class="shead"><div class="shead-row"><span class="shead-title">Notas</span></div></div>
  <div style="padding:14px 18px;border-bottom:1px solid var(--rule)">
    <textarea id="nota" style="width:100%;background:none;border:none;font-family:var(--mono);font-size:12px;color:var(--ink3);outline:none;resize:vertical;min-height:60px;line-height:1.7" placeholder="Sin plazo fijo. Sin intereses..." oninput="ST.nota=this.value;sched()"></textarea>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MESES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="pg" id="pg-meses">
  <div class="mstrip" id="mstrip"></div>
  <div id="mes-cnt"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     INVERSI√ìN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="pg" id="pg-inv">
  <div class="shead" style="margin-top:16px"><div class="shead-row">
    <span class="shead-title">Inversi√≥n inicial</span>
    <button class="shead-action" onclick="addInv()">+ fila</button>
  </div></div>
  <div class="ledger-wrap">
    <table class="ledger">
      <thead><tr><th>Concepto</th><th class="r">USD</th><th class="r">AUD</th><th>Nota</th><th></th></tr></thead>
      <tbody id="inv-body"></tbody>
      <tfoot>
        <tr class="total">
          <td class="bold">Total inversi√≥n</td>
          <td class="num a bold" id="inv-tu">USD 0.00</td>
          <td class="num a bold" id="inv-ta">AUD 0.00</td>
          <td colspan="2"></td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ANUAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="pg" id="pg-anual">
  <div class="shead" style="margin-top:16px"><div class="shead-row">
    <span class="shead-title">Balance anual</span>
    <span class="shead-sub">2026 ¬∑ 12 meses</span>
  </div></div>
  <div class="statrow statrow-4">
    <div class="stat"><div class="stat-lbl">Mejor mes</div><div class="stat-val g" style="font-size:16px" id="rs-mej">‚Äî</div><div class="stat-sub" id="rs-mejm">‚Äî</div></div>
    <div class="stat"><div class="stat-lbl">Peor mes</div><div class="stat-val r" style="font-size:16px" id="rs-peor">‚Äî</div><div class="stat-sub" id="rs-peorm">‚Äî</div></div>
    <div class="stat"><div class="stat-lbl">Meses activos</div><div class="stat-val" style="font-size:16px" id="rs-act">0/12</div></div>
    <div class="stat"><div class="stat-lbl">Prom. ahorro</div><div class="stat-val" style="font-size:16px" id="rs-prom">‚Äî</div></div>
  </div>

  <!-- GASTOS POR CATEGOR√çA -->
  <div class="shead"><div class="shead-row">
    <span class="shead-title">En qu√© m√°s gastaste</span>
    <span class="shead-sub" id="rs-gtotal">AUD 0 total</span>
  </div></div>
  <div id="cat-chart" style="padding:10px 0 2px;border-bottom:1px solid var(--rule)"></div>

  <!-- EVOLUCI√ìN MENSUAL -->
  <div class="shead"><div class="shead-row">
    <span class="shead-title">Evoluci√≥n mensual</span>
    <span class="shead-sub">ingresos ¬∑ gastos ¬∑ ahorro</span>
  </div></div>
  <div style="padding:14px 18px 12px;border-bottom:1px solid var(--rule);overflow-x:auto">
    <canvas id="bar-chart" height="130" style="width:100%;min-width:320px;display:block"></canvas>
  </div>

  <div class="ledger-wrap">
    <table class="ledger">
      <thead><tr><th>Mes</th><th class="r">Ingresos</th><th class="r">Gastos</th><th class="r">Ahorro</th><th class="r">USD</th></tr></thead>
      <tbody id="rs-body"></tbody>
      <tfoot>
        <tr class="total">
          <td class="bold">Total</td>
          <td class="num pos bold" id="rs-ti">‚Äî</td>
          <td class="num neg bold" id="rs-tg">‚Äî</td>
          <td class="num bold" id="rs-ta">‚Äî</td>
          <td class="num bold" id="rs-tu">‚Äî</td>
        </tr>
        <tr class="subtotal">
          <td class="italic dim">Promedio</td>
          <td class="num dim" id="rs-pi">‚Äî</td>
          <td class="num dim" id="rs-pg">‚Äî</td>
          <td class="num dim" id="rs-pa">‚Äî</td>
          <td class="num dim" id="rs-pau">‚Äî</td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<!-- FOOTER -->
<div class="fbar">
  <div class="fi"><div class="fi-lbl">Ahorro</div><div class="fi-val g" id="f-a">$0</div></div>
  <div class="fbar-div"></div>
  <div class="fi"><div class="fi-lbl">Caja</div><div class="fi-val a" id="f-c">$0</div></div>
  <div class="fbar-div"></div>
  <div class="fi"><div class="fi-lbl">Deuda</div><div class="fi-val r" id="f-d">$0</div></div>
</div>

<!-- GIS -->
<script src="https://accounts.google.com/gsi/client" async></script>
<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CONSTANTS & DEFAULTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const DRIVE_FILE = 'cf_australia_2025.json';
const DRIVE_SCOPE = 'https://www.googleapis.com/auth/drive.appdata';
const MN = ['ENERO','FEBRERO','MARZO','ABRIL','MAYO','JUNIO','JULIO','AGOSTO','SEPTIEMBRE','OCTUBRE','NOVIEMBRE','DICIEMBRE'];
const MS = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
const GK = ['arriendo','comida','transporte','servicios','telefono','salud','seguros','ropa','entretenimiento','viajes','cuidado','gym','otros'];
const GL = ['Arriendo / Vivienda','Comida / Supermercado','Transporte','Servicios','Tel√©fono','Salud','Seguros','Ropa','Entretenimiento','Viajes','Cuidado personal','Gym','Otros'];
const IK = ['freelance','bonificacion','familia','otros'];
const IL = ['Freelance / Extra','Bonificaci√≥n','Familia','Otros'];
const DEF_INV = [
  {c:'Visa / Documentos',u:158,a:0,d:''},
  {c:'Pasaje A√©reo',u:1727,a:0,d:''},
  {c:'Seguro M√©dico',u:230,a:0,d:''},
  {c:'Dep√≥sito vivienda',u:0,a:0,d:''},
  {c:'Muebles / Hogar',u:0,a:0,d:''},
  {c:'Tel√©fono / SIM',u:268,a:0,d:'Plan local + gastos llegada'},
  {c:'Transporte setup',u:0,a:0,d:''},
  {c:'Fondo emergencia',u:0,a:0,d:''},
];

function defM() {
  const g={}, n={}, ing={};
  GK.forEach(k=>{g[k]=0; n[k]='';});
  IK.forEach(k=>{ing[k]=0;});
  return {semanas:[0,0,0,0,0], ingresos:ing, gastos:g, notas:n};
}
function initST() {
  return {
    tc:.7079, tcTime:'', nota:'', pagos:[],
    invItems: JSON.parse(JSON.stringify(DEF_INV)),
    months: MN.map((_,i)=>{
      let m = defM();
      if(i===1){m.gastos.comida=132.51;m.gastos.transporte=45;m.gastos.cuidado=17;m.gastos.otros=123;m.notas.otros='Afeitadora / Kebap';}
      return m;
    })
  };
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let ST = {}, saveT = null;
let gToken = null, driveFileId = null, useGoogle = false;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LOCAL STORAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const lsave = () => { try { localStorage.setItem('cf_aus', JSON.stringify(ST)); } catch(e){} };
const lload = () => { try { const d = localStorage.getItem('cf_aus'); return d ? JSON.parse(d) : null; } catch(e){ return null; } };

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GOOGLE DRIVE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const getClientId = () => localStorage.getItem('cf_cid') || '181059148005-jbpua2ag12jpvh6niff7jovlniklogu3.apps.googleusercontent.com';

function startGoogle() {
  const cid = getClientId();
  if(!cid) { document.getElementById('setup').style.display = 'block'; return; }
  if(typeof google === 'undefined' || !google.accounts) {
    document.getElementById('auth-err').textContent = 'Cargando Google... intent√° de nuevo en 2 segundos.';
    setTimeout(() => startGoogle(), 2000);
    return;
  }
  doSignIn(cid);
}
function saveClientId() {
  const cid = document.getElementById('cid-inp').value.trim();
  if(!cid || !cid.includes('apps.googleusercontent.com')) { alert('Client ID inv√°lido'); return; }
  localStorage.setItem('cf_cid', cid);
  document.getElementById('setup').style.display = 'none';
  doSignIn(cid);
}
function doSignIn(clientId) {
  document.getElementById('auth-err').textContent = 'Abriendo Google...';
  const client = google.accounts.oauth2.initTokenClient({
    client_id: clientId,
    scope: DRIVE_SCOPE,
    callback: async (resp) => {
      if(resp.error) { document.getElementById('auth-err').textContent = 'Error: '+resp.error; return; }
      gToken = resp.access_token;
      useGoogle = true;
      localStorage.setItem('cf_ug','1');
      document.getElementById('auth').style.display = 'none';
      document.getElementById('loading').classList.remove('hide');
      await bootDrive();
    }
  });
  client.requestAccessToken();
}
function skipAuth() {
  useGoogle = false;
  localStorage.removeItem('cf_ug');
  document.getElementById('auth').style.display = 'none';
  bootLocal();
}

async function driveReq(url, opts={}) {
  const res = await fetch(url, { ...opts, headers:{ 'Authorization':'Bearer '+gToken, ...(opts.headers||{}) } });
  if(!res.ok) throw new Error('Drive '+res.status);
  return res;
}
async function findFile() {
  const r = await driveReq(`https://www.googleapis.com/drive/v3/files?spaces=appDataFolder&q=name='${DRIVE_FILE}'&fields=files(id)`);
  const d = await r.json(); return d.files?.[0]?.id || null;
}
async function readFile(id) {
  const r = await driveReq(`https://www.googleapis.com/drive/v3/files/${id}?alt=media`);
  return await r.json();
}
async function createFile(content) {
  const meta = {name:DRIVE_FILE, parents:['appDataFolder']};
  const form = new FormData();
  form.append('metadata', new Blob([JSON.stringify(meta)], {type:'application/json'}));
  form.append('file', new Blob([JSON.stringify(content)], {type:'application/json'}));
  const r = await driveReq('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {method:'POST', body:form});
  return (await r.json()).id;
}
async function updateFile(id, content) {
  await driveReq(`https://www.googleapis.com/upload/drive/v3/files/${id}?uploadType=media`, {
    method:'PATCH', headers:{'Content-Type':'application/json'}, body: JSON.stringify(content)
  });
}
async function saveDrive() {
  try {
    setEl('sync-st', '‚Üë ...');
    if(!driveFileId) driveFileId = await findFile();
    if(driveFileId) await updateFile(driveFileId, ST);
    else driveFileId = await createFile(ST);
    const t = new Date().toLocaleTimeString('es-AR',{hour:'2-digit',minute:'2-digit'});
    setEl('sync-st','‚úì '+t); lsave();
  } catch(e) { setEl('sync-st','‚ö† local'); lsave(); }
}
async function syncNow() {
  if(useGoogle) { toast('Guardando...', 900); await saveDrive(); toast('Drive actualizado ‚úì'); }
  else { lsave(); toast('Guardado ‚úì'); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BOOT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function bootDrive() {
  try {
    driveFileId = await findFile();
    if(driveFileId) {
      ST = await readFile(driveFileId);
      if(!ST.pagos) ST.pagos = [];
      if(!ST.nota) ST.nota = '';
      if(!ST.months || ST.months.length!==12) ST.months = initST().months;
      if(!ST.invItems) ST.invItems = JSON.parse(JSON.stringify(DEF_INV));
      setEl('sync-st','‚úì Drive');
      toast('Cargado desde Drive ‚úì', 2000);
    } else {
      ST = lload() || initST();
      setEl('sync-st','nuevo en Drive');
    }
  } catch(e) { ST = lload() || initST(); setEl('sync-st','‚ö† local'); }
  finishBoot();
}
function bootLocal() {
  ST = lload() || initST();
  setEl('sync-st','local');
  finishBoot();
}
function finishBoot() {
  document.getElementById('loading').classList.add('hide');
  document.getElementById('pago-f').value = new Date().toISOString().slice(0,10);
  renderTC(); updateAll();
  updateTC();
  setInterval(updateTC, 30*60*1000);
  if(useGoogle) setInterval(saveDrive, 3*60*1000);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCHED SAVE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function sched() {
  lsave();
  if(saveT) clearTimeout(saveT);
  saveT = setTimeout(()=>{ if(useGoogle) saveDrive(); else lsave(); }, 2000);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TYPE DE CAMBIO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function fetchTC() {
  const apis = [
    ()=>fetch('https://open.er-api.com/v6/latest/AUD').then(r=>r.json()).then(d=>{ if(d.result==='success') return d.rates?.USD; throw 0; }),
    ()=>fetch('https://api.exchangerate-api.com/v4/latest/AUD').then(r=>r.json()).then(d=>d.rates?.USD),
    ()=>fetch('https://cdn.jsdelivr.net/gh/fawazahmed0/currency-api@1/latest/currencies/aud/usd.json').then(r=>r.json()).then(d=>d.usd),
    ()=>fetch('https://api.frankfurter.app/latest?from=AUD&to=USD').then(r=>r.json()).then(d=>d.rates?.USD),
  ];
  for(const fn of apis) { try { const v = await fn(); if(v&&v>.4&&v<1.2) return +v.toFixed(6); } catch(e){} }
  return null;
}
async function updateTC() {
  document.getElementById('tc-dot').style.background = '#f0a020';
  const v = await fetchTC();
  if(v) { ST.tc=v; ST.tcTime=new Date().toLocaleTimeString('es-AR',{hour:'2-digit',minute:'2-digit'}); sched(); document.getElementById('tc-dot').style.background='#4caf50'; }
  else document.getElementById('tc-dot').style.background = '#e07070';
  renderTC(); updateAll();
}
function renderTC() {
  const t = ST.tc||.7079;
  setEl('tc-v', `1 AUD = ${t.toFixed(4)} USD`);
  setEl('tc-t', ST.tcTime ? `¬∑ ${ST.tcTime}` : '');
  const inp = document.getElementById('tc-inp');
  if(inp && document.activeElement!==inp) inp.value = t.toFixed(4);
  setEl('tc-src', ST.tcTime ? 'autom√°tico' : 'manual');
}
function manualTC() {
  const v = +document.getElementById('tc-inp').value;
  if(v>.2 && v<2) { ST.tc=v; sched(); renderTC(); updateAll(); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CALCS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const tc  = () => ST.tc || .7079;
const a2u = n => n * tc();
const u2a = n => n / tc();
const mSal = i => ST.months[i].semanas.reduce((a,b)=>a+b, 0);
const mIng = i => mSal(i) + IK.reduce((s,k)=>s+(ST.months[i].ingresos[k]||0), 0);
const mGas = i => GK.reduce((s,k)=>s+(ST.months[i].gastos[k]||0), 0);
const mAho = i => mIng(i) - mGas(i);
const tGan = () => MN.reduce((_,__,i)=>_+mIng(i), 0);
const tGas = () => MN.reduce((_,__,i)=>_+mGas(i), 0);
const tAho = () => tGan() - tGas();
const tIU  = () => ST.invItems.reduce((s,x)=>s+(+x.u||0), 0);
const tIA  = () => { const a = ST.invItems.reduce((s,x)=>s+(+x.a||0),0); return a || u2a(tIU()); };
const tPag = () => (ST.pagos||[]).reduce((s,p)=>s+(+p.montoAUD||0), 0);

function calcD() {
  const invA = tIA();
  let gsi = 0;
  MN.forEach((_,i)=>{
    const ing=mIng(i), gas=mGas(i);
    if(!ing && gas>0) gsi += gas;
    else if(ing>0 && gas>ing) gsi += gas-ing;
  });
  const bruta=invA+gsi, pag=tPag(), pend=Math.max(0,bruta-pag);
  const caja=Math.max(0, Math.max(0,tAho())-pag);
  return {invA, gsi, bruta, pag, pend, caja};
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FORMAT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function fn(n,d=0) {
  if(isNaN(n)||n==null) return '‚Äî';
  const a = Math.abs(n).toLocaleString('en-AU',{minimumFractionDigits:d,maximumFractionDigits:d});
  return n<0 ? '-'+a : a;
}
const fA  = (n,d=0) => `AUD ${fn(n,d)}`;
const fU  = (n,d=0) => `USD ${fn(n,d)}`;
const fA2 = n => `AUD ${fn(n,2)}`;
const fU2 = n => `USD ${fn(n,2)}`;
const fN  = (n,d=0) => fn(n,d);   // bare number

function setEl(id,v) { const e=document.getElementById(id); if(e) e.textContent=v; }
function esc(s) { return (s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;'); }
function fDate(f) { if(!f) return '‚Äî'; try { return new Date(f+'T12:00:00').toLocaleDateString('es-AR',{day:'2-digit',month:'short',year:'numeric'}); } catch{ return f; } }
function toast(msg, dur=2000) { const e=document.getElementById('toast'); e.textContent=msg; e.classList.add('show'); setTimeout(()=>e.classList.remove('show'),dur); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   UPDATE ALL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateAll() { renderTC(); updDash(); updDeuda(); updInv(); updAnual(); updFoot(); }

function updFoot() {
  const aho=tAho(), d=calcD();
  const ae = document.getElementById('f-a');
  ae.textContent = fA(aho); ae.className = 'fi-val '+(aho>=0?'g':'r');
  setEl('f-c', fA(d.caja)); setEl('f-d', fA(d.pend));
}

function updDash() {
  const gan=tGan(), gas=tGas(), aho=tAho(), invA=tIA(), invU=tIU(), d=calcD();
  setEl('d-ga', fA(gan)); setEl('d-gu', fU(a2u(gan)));
  setEl('d-gsa', fA(gas)); setEl('d-gsu', fU(a2u(gas)));
  const ae = document.getElementById('d-aa');
  ae.textContent = fA(aho); ae.className = 'stat-val '+(aho>=0?'g':'r');
  setEl('d-au', fU(a2u(aho)));
  setEl('d-ia', fA(invA)); setEl('d-iu', fU(invU));

  setEl('d-ca', fA2(d.caja)); setEl('d-cu', 'Ahorro acumulado ‚àí pagos realizados');
  setEl('d-cau', fU2(a2u(d.caja)));
  setEl('d-da', fA2(d.pend)); setEl('d-du', fU2(a2u(d.pend)));

  const pct = d.bruta>0 ? Math.min(100, d.pag/d.bruta*100) : 0;
  setEl('d-dapct', pct.toFixed(0)+'%');
  const pb = document.getElementById('d-pbar');
  pb.style.width = pct.toFixed(1)+'%';
  pb.className = 'progbar-fill '+(pct>=50?'':'a');

  // √∫ltimo mes
  let lm=-1;
  for(let i=11;i>=0;i--) { if(mGas(i)||mIng(i)) {lm=i; break;} }
  const le = document.getElementById('d-last-content');
  const ln = document.getElementById('d-lm-name');
  if(lm<0) { le.innerHTML='<div class="empty">Sin datos a√∫n</div>'; setEl('d-lm-name','‚Äî'); return; }
  setEl('d-lm-name', MN[lm]);
  const ing=mIng(lm), g2=mGas(lm), aho2=mAho(lm);
  le.innerHTML = `<table class="ledger"><tbody>
    <tr><td class="label-cell">Ingresos</td><td class="num pos">${fA2(ing)}</td><td class="num dim">${fU2(a2u(ing))}</td></tr>
    <tr><td class="label-cell">Gastos</td><td class="num neg">${fA2(g2)}</td><td class="num dim">${fU2(a2u(g2))}</td></tr>
    <tr class="total"><td class="bold">Ahorro</td><td class="num bold ${aho2>=0?'pos':'neg'}">${fA2(aho2)}</td><td class="num dim">${fU2(a2u(aho2))}</td></tr>
  </tbody></table>`;
}

function updDeuda() {
  const d = calcD();
  const pct = d.bruta>0 ? Math.min(100, d.pag/d.bruta*100) : 0;

  setEl('deu-chip', fA2(d.pend));
  document.getElementById('deu-chip').className = 'chip '+(d.pend<=0?'g':'r');

  setEl('dl-inv',   fN(d.invA,2)); setEl('dl-invu',  fN(a2u(d.invA),2));
  setEl('dl-gsi',   fN(d.gsi,2));  setEl('dl-gsiu',  fN(a2u(d.gsi),2));
  setEl('dl-bruta', fN(d.bruta,2)); setEl('dl-brutau',fN(a2u(d.bruta),2));
  setEl('dl-pag',   fN(d.pag,2));  setEl('dl-pagu',  fN(a2u(d.pag),2));
  setEl('dl-pend',  fN(d.pend,2)); setEl('dl-pendu', fN(a2u(d.pend),2));

  const pe = document.getElementById('dl-pend');
  if(pe) pe.className = 'num bold '+(d.pend<=0?'pos':'neg');

  document.getElementById('deu-bar').style.width = pct.toFixed(1)+'%';
  setEl('deu-pct', pct.toFixed(1)+'%');
  setEl('deu-ca', fA2(d.caja)); setEl('deu-cau', fU2(a2u(d.caja)));

  const nota = document.getElementById('nota');
  if(nota && document.activeElement!==nota) nota.value = ST.nota||'';

  // pagos list
  const pl = document.getElementById('pag-list');
  if(!ST.pagos?.length) { pl.innerHTML='<div class="empty">Sin pagos a√∫n.</div>'; setEl('deu-np','0 pagos'); return; }
  const tot = ST.pagos.reduce((s,p)=>s+(+p.montoAUD||0),0);
  pl.innerHTML = `<div style="padding:8px 18px;border-bottom:1px solid var(--rule);display:flex;justify-content:space-between;font-size:10px;color:var(--ink4)"><span>${ST.pagos.length} pago${ST.pagos.length!==1?'s':''}</span><span style="color:var(--green);font-weight:600">${fA2(tot)}</span></div>`+
    [...ST.pagos].reverse().map((p,ri)=>{
      const idx = ST.pagos.length-1-ri;
      return `<div class="pay-row"><div><div class="pay-date">${fDate(p.fecha)}</div><div class="pay-desc">${esc(p.desc||'Pago a padres')}</div></div><div><div class="pay-aud">${fA2(p.montoAUD)}</div><div class="pay-usd">${fU2(a2u(p.montoAUD))}</div><button class="btn r sm" style="margin-top:5px" onclick="delPag(${idx})">‚úï</button></div></div>`;
    }).join('');
  setEl('deu-np', ST.pagos.length+' pago'+(ST.pagos.length!==1?'s':''));
  calcCuota();
}

function regPago() {
  const f=document.getElementById('pago-f').value, m=+document.getElementById('pago-m').value||0, desc=document.getElementById('pago-d').value.trim();
  if(!m) { alert('Ingres√° un monto.'); return; }
  if(!f) { alert('Ingres√° la fecha.'); return; }
  const d = calcD();
  if(m > d.caja+.01 && !confirm(`El monto (${fA2(m)}) supera la caja (${fA2(d.caja)}). ¬øRegistrar igual?`)) return;
  if(!ST.pagos) ST.pagos=[];
  ST.pagos.push({id:Date.now(), fecha:f, montoAUD:m, desc:desc||'Pago a padres'});
  sched();
  document.getElementById('pago-f').value = new Date().toISOString().slice(0,10);
  document.getElementById('pago-m').value = '';
  document.getElementById('pago-d').value = '';
  updateAll(); toast('Pago registrado ‚úì');
}
function delPag(idx) {
  const p = ST.pagos[idx]; if(!p) return;
  if(confirm(`¬øEliminar pago de ${fA2(p.montoAUD)} del ${fDate(p.fecha)}?`)) { ST.pagos.splice(idx,1); sched(); updateAll(); }
}
function calcCuota() {
  const m=+document.getElementById('cuota-m')?.value||0, d=calcD();
  const re=document.getElementById('cuota-r'), sub=document.getElementById('cuota-s'); if(!re) return;
  if(m>0 && d.pend>0) { re.textContent=fA2(d.pend/m); if(sub) sub.textContent=`= ${fU2(a2u(d.pend/m))} / mes ¬∑ ${fA(d.pend)} en ${m} mes${m!==1?'es':''}`; }
  else { re.textContent='‚Äî'; if(sub) sub.textContent = d.pend<=0 ? '¬°Deuda saldada! üéâ' : 'Ingres√° cantidad de meses'; }
}

function updInv() {
  ST.invItems.forEach(x=>{ if((+x.u)>0 && !(+x.a)) x.a = +((+x.u/tc()).toFixed(2)); });
  const tb = document.getElementById('inv-body'); tb.innerHTML = '';
  ST.invItems.forEach((it,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td style="min-width:130px"><input class="inp-text" value="${esc(it.c)}" oninput="ST.invItems[${i}].c=this.value;sched()"></td>
      <td style="min-width:90px"><input class="inp-num" type="number" step=".01" inputmode="decimal" value="${it.u||''}" placeholder="0.00" oninput="ST.invItems[${i}].u=+this.value||0;ST.invItems[${i}].a=+((+this.value||0)/tc()).toFixed(2);sched();updInv();updateAll()"></td>
      <td style="min-width:100px"><input class="inp-num" type="number" step=".01" inputmode="decimal" value="${it.a||''}" placeholder="0.00" oninput="ST.invItems[${i}].a=+this.value||0;ST.invItems[${i}].u=+((+this.value||0)*tc()).toFixed(2);sched();updInv();updateAll()"></td>
      <td style="min-width:140px"><input class="inp-text" value="${esc(it.d||'')}" placeholder="Nota..." oninput="ST.invItems[${i}].d=this.value;sched()"></td>
      <td><button class="btn r sm" onclick="ST.invItems.splice(${i},1);sched();updInv();updateAll()">‚úï</button></td>`;
    tb.appendChild(tr);
  });
  setEl('inv-tu', fU2(tIU())); setEl('inv-ta', fA2(tIA()));
}
function addInv() { ST.invItems.push({c:'Nuevo √≠tem',u:0,a:0,d:''}); sched(); updInv(); updateAll(); }

function updAnual() {
  let ti=0, tg=0, ta=0, bA=-Infinity, wA=Infinity, bM='‚Äî', wM='‚Äî', act=0;
  const tb = document.getElementById('rs-body'); tb.innerHTML = '';
  const barIng=[], barGas=[], barAho=[];
  MN.forEach((m,i)=>{
    const ing=mIng(i), gas=mGas(i), aho=mAho(i);
    if(ing||gas) { act++; if(aho>bA){bA=aho;bM=MS[i];} if(aho<wA){wA=aho;wM=MS[i];} }
    ti+=ing; tg+=gas; ta+=aho;
    barIng.push(ing); barGas.push(gas); barAho.push(aho);
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${MS[i]}</td><td class="num ${ing?'pos dim':''}">${ing?fA(ing):'‚Äî'}</td><td class="num ${gas?'neg dim':''}">${gas?fA(gas):'‚Äî'}</td><td class="num ${aho<0?'neg':aho>0?'pos':''} ${ing||gas?'':'dim'}">${ing||gas?fA(aho):'‚Äî'}</td><td class="num dim">${ing||gas?fU(a2u(aho)):'‚Äî'}</td>`;
    tb.appendChild(tr);
  });
  const dv = Math.max(1,act);
  setEl('rs-ti', fA(ti)); setEl('rs-tg', fA(tg)); setEl('rs-ta', fA(ta)); setEl('rs-tu', fU(a2u(ta)));
  setEl('rs-pi', fA(ti/dv)); setEl('rs-pg', fA(tg/dv)); setEl('rs-pa', fA(ta/dv)); setEl('rs-pau', fU(a2u(ta/dv)));
  setEl('rs-mej', bA>-Infinity?fA(bA):'‚Äî'); setEl('rs-mejm', bM);
  setEl('rs-peor', wA<Infinity?fA(wA):'‚Äî'); setEl('rs-peorm', wM);
  setEl('rs-act', act+'/12'); setEl('rs-prom', fA(ta/dv));

  // ‚îÄ‚îÄ CATEGORY CHART ‚îÄ‚îÄ
  const catTotals = GK.map((k,ki)=>({
    k, lbl: GL[ki],
    val: MN.reduce((_,__,i)=>_+(ST.months[i].gastos[k]||0), 0)
  })).filter(x=>x.val>0).sort((a,b)=>b.val-a.val);

  setEl('rs-gtotal', `${fA(tg)} total`);
  const cc = document.getElementById('cat-chart');
  if(!catTotals.length) { cc.innerHTML='<div class="empty">Sin gastos registrados a√∫n</div>'; }
  else {
    const max = catTotals[0].val;
    cc.innerHTML = catTotals.map((c,idx)=>{
      const pct = max>0 ? (c.val/max*100).toFixed(1) : 0;
      const pctTotal = tg>0 ? (c.val/tg*100).toFixed(0) : 0;
      const colors = ['var(--red)','var(--ink2)','var(--amber)','var(--green)','var(--ink3)','#8B5E3C','#4A5568','#2C5282','#276749','#702459'];
      const col = colors[idx % colors.length];
      return `<div style="display:flex;align-items:center;gap:10px;padding:7px 18px;border-bottom:1px solid var(--rule)">
        <div style="width:110px;flex-shrink:0;font-size:10px;color:var(--ink3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${c.lbl}</div>
        <div style="flex:1;height:8px;background:var(--paper3);overflow:hidden">
          <div style="height:100%;width:${pct}%;background:${col};transition:width .6s ease"></div>
        </div>
        <div style="width:80px;text-align:right;font-size:11px;font-weight:600;color:var(--ink);font-variant-numeric:tabular-nums;flex-shrink:0">${fA(c.val,0)}</div>
        <div style="width:30px;text-align:right;font-size:10px;color:var(--ink4);flex-shrink:0">${pctTotal}%</div>
      </div>`;
    }).join('');
  }

  // ‚îÄ‚îÄ BAR CHART (canvas) ‚îÄ‚îÄ
  const canvas = document.getElementById('bar-chart');
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth || 340;
  const H = 130;
  canvas.width = W * window.devicePixelRatio;
  canvas.height = H * window.devicePixelRatio;
  canvas.style.width = W+'px'; canvas.style.height = H+'px';
  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

  const PAD = {top:10, right:10, bottom:22, left:50};
  const cW = W - PAD.left - PAD.right;
  const cH = H - PAD.top - PAD.bottom;
  const allVals = [...barIng, ...barGas.map(v=>-v), ...barAho];
  const maxV = Math.max(...allVals.filter(v=>v>0), 1);
  const minV = Math.min(...allVals.filter(v=>v<0), 0);
  const range = maxV - minV || 1;
  const toY = v => PAD.top + cH * (1 - (v - minV) / range);
  const bw = cW / 12;

  // background
  ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--paper').trim();
  ctx.fillRect(0,0,W,H);

  // zero line
  const zy = toY(0);
  ctx.strokeStyle = '#C4BFB5'; ctx.lineWidth = 1;
  ctx.beginPath(); ctx.moveTo(PAD.left,zy); ctx.lineTo(W-PAD.right,zy); ctx.stroke();

  // grid lines
  ctx.strokeStyle = '#E8E4DA'; ctx.lineWidth = .5;
  [.25,.5,.75,1].forEach(f=>{
    const y = PAD.top + cH*f;
    ctx.beginPath(); ctx.moveTo(PAD.left,y); ctx.lineTo(W-PAD.right,y); ctx.stroke();
  });

  // bars
  MS.forEach((m,i)=>{
    const x = PAD.left + i*bw;
    const bwInner = bw * 0.55;
    const xOff = (bw - bwInner) / 2;

    // income bar
    if(barIng[i]>0){
      const y=toY(barIng[i]), h=zy-y;
      ctx.fillStyle = '#2A5C3F22';
      ctx.fillRect(x+xOff, y, bwInner, h);
      ctx.fillStyle = '#1C3D2A';
      ctx.fillRect(x+xOff, y, 2, h);
    }
    // expense bar
    if(barGas[i]>0){
      const y=zy, h=toY(-barGas[i])-zy;
      ctx.fillStyle = '#5C1A1A22';
      ctx.fillRect(x+xOff, y, bwInner, h);
      ctx.fillStyle = '#5C1A1A';
      ctx.fillRect(x+xOff+bwInner-2, y, 2, h);
    }
    // savings dot
    if(barIng[i]||barGas[i]){
      const sy = toY(barAho[i]);
      ctx.fillStyle = barAho[i]>=0?'#1C3D2A':'#5C1A1A';
      ctx.beginPath(); ctx.arc(x+bw/2, sy, 3, 0, Math.PI*2); ctx.fill();
    }

    // month label
    ctx.fillStyle = '#A09C96';
    ctx.font = `500 ${Math.max(8, Math.min(9,bw*0.55))}px IBM Plex Mono, monospace`;
    ctx.textAlign = 'center';
    ctx.fillText(m.slice(0,1), x+bw/2, H-6);
  });

  // Y axis labels
  ctx.fillStyle = '#A09C96'; ctx.font = '8px IBM Plex Mono, monospace'; ctx.textAlign = 'right';
  [0,.5,1].forEach(f=>{
    const v = minV + range*f;
    const y = toY(v);
    if(Math.abs(y-PAD.top)<8 || Math.abs(y-(H-PAD.bottom))<8) return;
    ctx.fillText((v>=0?'':'-')+fN(Math.abs(v),0), PAD.left-4, y+3);
  });

  // legend
  const lx = W - PAD.right - 10;
  ctx.font = '8px IBM Plex Mono, monospace'; ctx.textAlign = 'right';
  ctx.fillStyle='#1C3D2A'; ctx.fillRect(lx-30,PAD.top,8,8);
  ctx.fillStyle='#A09C96'; ctx.fillText('Ing',lx-22+28,PAD.top+8);
  ctx.fillStyle='#5C1A1A'; ctx.fillRect(lx-30,PAD.top+12,8,8);
  ctx.fillStyle='#A09C96'; ctx.fillText('Gas',lx-22+28,PAD.top+20);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MESES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let cM = 0;
function renderStrip() {
  const c = document.getElementById('mstrip'); c.innerHTML = '';
  MN.forEach((m,i)=>{
    const hd = mIng(i)||mGas(i);
    const el = document.createElement('div');
    el.className = 'mtab'+(i===cM?' on':'')+(hd?' has':'');
    el.innerHTML = MS[i] + (hd ? '<span class="mdot"></span>' : '');
    el.onclick = ()=>{ cM=i; renderStrip(); renderMes(); };
    c.appendChild(el);
  });
}
function renderMes() {
  const i=cM, m=ST.months[i];
  const sal=mSal(i), ing=mIng(i), gas=mGas(i), aho=mAho(i);
  const sinI=!ing&&gas>0, bon=aho>0&&ing>0;
  document.getElementById('mes-cnt').innerHTML = `
    ${sinI ? `<div class="band r" style="margin-bottom:0"><div><div class="band-lbl">Sin ingresos este mes</div><div style="font-size:12px;color:var(--red);font-family:var(--mono)">Los ${fA(gas)} gastados suman a tu deuda.</div></div></div>` : ''}
    ${bon ? `<div class="band g" style="margin-bottom:0"><div><div class="band-lbl">Mes positivo</div><div style="font-size:12px;color:var(--green);font-family:var(--mono)">${fA(aho)} van a tu caja disponible.</div></div></div>` : ''}

    <!-- Resumen del mes -->
    <table class="ledger"><tbody>
      <tr class="subtotal"><td class="bold">${MN[i]}</td><td class="num bold ${aho>=0?'pos':'neg'}">${fA2(aho)}</td><td class="num dim">${fU2(a2u(aho))}</td></tr>
      <tr><td class="label-cell italic">Ingresos totales</td><td class="num pos">${fA2(ing)}</td><td class="num dim">${fU2(a2u(ing))}</td></tr>
      <tr><td class="label-cell italic">Gastos totales</td><td class="num neg">${fA2(gas)}</td><td class="num dim">${fU2(a2u(gas))}</td></tr>
    </tbody></table>

    <!-- Salario semanal -->
    <div class="shead" style="margin-top:16px"><div class="shead-row">
      <span class="shead-title">Salario semanal</span>
      <span class="shead-sub" id="salb-${i}">${fA2(sal)}</span>
    </div></div>
    <div class="week-grid">
      ${[0,1,2,3,4].map(s=>`
        <div class="week-cell">
          <div class="week-lbl">Sem ${s+1}</div>
          <input class="week-inp" type="number" step=".01" inputmode="decimal" value="${m.semanas[s]||''}" placeholder="0"
            oninput="ST.months[${i}].semanas[${s}]=+this.value||0;sched();updateAll();const b=document.getElementById('salb-${i}');if(b)b.textContent=fA2(mSal(${i}))">
        </div>`).join('')}
    </div>
    <div style="padding:8px 18px;border-bottom:1px solid var(--rule);display:flex;justify-content:space-between;font-size:10px;color:var(--ink4)">
      <span>Total mensual</span><span style="color:var(--green);font-weight:600">${fA2(sal)} = ${fU2(a2u(sal))}</span>
    </div>

    <!-- Otros ingresos -->
    <div class="shead"><div class="shead-row"><span class="shead-title">Otros ingresos</span></div></div>
    <table class="ledger"><tbody>
      ${IK.map((k,ki)=>`
        <tr>
          <td class="label-cell" style="min-width:140px">${IL[ki]}</td>
          <td style="min-width:110px"><input class="inp-num" type="number" step=".01" inputmode="decimal" value="${m.ingresos[k]||''}" placeholder="‚Äî"
            oninput="ST.months[${i}].ingresos['${k}']=+this.value||0;sched();updateAll()"></td>
          <td class="num dim" style="min-width:90px">${m.ingresos[k]?fU2(a2u(m.ingresos[k])):'‚Äî'}</td>
        </tr>`).join('')}
    </tbody></table>

    <!-- Gastos -->
    <div class="shead"><div class="shead-row"><span class="shead-title">Gastos</span></div></div>
    <table class="ledger"><tbody>
      ${GK.map((k,ki)=>`
        <tr>
          <td class="label-cell" style="min-width:140px">${GL[ki]}</td>
          <td style="min-width:110px"><input class="inp-num" type="number" step=".01" inputmode="decimal" value="${m.gastos[k]||''}" placeholder="‚Äî"
            oninput="ST.months[${i}].gastos['${k}']=+this.value||0;sched();updateAll()"></td>
          <td class="num dim" style="min-width:90px">${m.gastos[k]?fU2(a2u(m.gastos[k])):'‚Äî'}</td>
          <td style="min-width:130px"><input class="inp-text" value="${esc(m.notas[k]||'')}" placeholder="nota..."
            oninput="ST.months[${i}].notas['${k}']=this.value;sched()"></td>
        </tr>`).join('')}
      <tr class="total"><td class="bold">Total gastos</td><td class="num neg bold">${fA2(gas)}</td><td class="num dim">${fU2(a2u(gas))}</td><td></td></tr>
    </tbody></table>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NAV
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function go(name, el) {
  document.querySelectorAll('.pg').forEach(p=>p.classList.remove('on'));
  document.getElementById('pg-'+name).classList.add('on');
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('on'));
  if(el) el.classList.add('on');
  if(name==='meses') { renderStrip(); renderMes(); }
  updateAll(); window.scrollTo(0,0);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
window.addEventListener('DOMContentLoaded', ()=>{
  document.getElementById('loading').classList.add('hide');
  document.getElementById('auth').style.display = 'flex';
});
</script>
</body>
</html>
